# Collects build symbols and publishes them as 'Symbols'
---
parameters:
  OneESPT: false

steps:
- template: ../tasks/CopyFiles.yml
  parameters:
    displayName: 'Collect build symbols'
    SourceFolder: '$(Build.SourcesDirectory)'
    Contents: '$(Build.SourcesDirectory)\bin\**\*.+(pdb|exe|dll)'
    TargetFolder: '$(Build.ArtifactStagingDirectory)/symbols'
    CleanTargetFolder: true

    
- task: ms-vseng.MicroBuildShipTasks.0ffdda1d-8c7b-40da-b8b1-061660eaeea3.MicroBuildArchiveSymbols@5
  displayName: 'Archive MIEngine_MDD on Symweb'
  inputs:
    SymbolsFeatureName: MIEngine
    SymbolsProject: VS
    SymbolsAgentPath: '$(Build.ArtifactStagingDirectory)\Symbols\'
    ExcludeAgentFolders: '$(Build.ArtifactStagingDirectory)\Symbols\bin\Debug;$(Build.ArtifactStagingDirectory)\Symbols\bin\Lab.Debug'
    ${{ if parameters.OneESPT }}:
      ExpirationInDays: 3650 # Expire in 10 years for release builds
    ${{ else }}:
      ExpirationInDays: 1 # Expire in 1 day if used for testing
            
- template: ../tasks/1ES/PublishPipelineArtifact.yml
  parameters:
    displayName: 'Publish Symbols Artifact'
    targetPath: '$(Build.ArtifactStagingDirectory)/symbols' 
    artifactName: 'Symbols'
    OneESPT: ${{ parameters.OneESPT }}
...